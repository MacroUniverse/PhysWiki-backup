% test
% test


\section*{SPN结构的差分密码分析}
\begin{tikzpicture} 
    \tikzmath{ %数学程序编写，定义的变量可以在其外部使用，里面所有语句都要加分号; 并且不能有多余的回车
        function paint(\a){
            int \co, \keyMixRectH, \keyMixRectW, \sboxInH, \sboxOutH, \interval,\intervalRoundFive,\yOne, \xOne, \xb, \xj, \xk, \yb;
            \co = 0.5;
            \keyMixRectH = 3*\co;
            \keyMixRectW = 35*\co;
            \sboxInH = 3*\co;
            \sboxWidth = 5*\co;
            \sboxOutH = 10*\co;
            \interval = \keyMixRectH + \sboxOutH + \sboxWidth + \sboxInH;
            \intervalRoundFive = \keyMixRectH + \sboxWidth + 2 * \sboxInH;
            for \i in {0,...,5} {
                \yOne = 0;
                if \i == 0 then{
                    \xOne = 0;
                }else{
                    if \i == 1 then {
                        \xOne = \intervalRoundFive;
                    }else{
                        \xOne = \intervalRoundFive + (\i - 1)*\interval;
                    };
                };
                {
                    \node[rectangle, thick, minimum width = \keyMixRectW, minimum height = \keyMixRectH, draw = pink!100, fill = purple!20] at (\xOne + \keyMixRectW/2, \yOne + \keyMixRectW/2) {$\lxor$};
                };
            };
            for \i in {0,...,4}{
                \xb=0;
                \yb=\keyMixRectH + \sboxInH;
                if \i >= 0 then {
                    \yb = \yb + (\i - 1)*\interval;
                };
                for \j in {0,...,3}{
                    \xSbox = 2 * \j * \sboxWidth
                    {
                        \node[rectangle, thick, minimum width = \sboxWidth, minimum height = \sboxWidth, draw = pink!100, fill = purple!20] at (\xOne + \sboxWidth/2, \yOne + \sboxWidth/2) {$\S$};
                    };
                };
            };
            for \i in {0,...,5}{
                \xb = 1;
                if \i == 0 then{
                    \yb = \keyMixRectH;
                }else{
                    if \i == 1 then {
                        \yb = \keyMixRectH + \sboxInH + \sboxWidth;
                    }else{
                        \yb = \keyMixRectH + \sboxInH + \sboxWidth + (\i - 1)*\interval;
                    };
                };
                for \j in {0,...,3}{
                    \xj = \xb + 2 * \j *\sboxWidth;
                    for \k in {0,...,3}{
                        \xk = \xj + \k * \co;
                        {
                            \draw[->] (\xk, \yb + \sboxInH) -- (\xk, \yb);
                        };
                    };
                };
            };
            for \i in {0,...,3}{
                \yb = \keyMixRectH * 2 + \sboxInH * 2 + \sboxWidth;
                if \i > 0 then {
                    \yb = \yb + (\i - 1)*\interval;
                };
                {
                    draw[->] (1*\co, \yb + \sboxOutH) -- (1*\co, \yb);
                };
            };
        };
        \a=1;
        paint(\a);
    }
\end{tikzpicture}
